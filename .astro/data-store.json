[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.9.3","content-config-digest","28ff8d10b8b355b9","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://evallesp.github.io\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{\"/\":\"/blog\"},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"experimentalDefaultStyles\":true},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"responsiveImages\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"csp\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12],"ai-ansible-molecule",{"id":11,"data":13,"body":18,"filePath":19,"assetImports":20,"digest":24,"rendered":25},{"title":14,"description":15,"pubDate":16,"heroImage":17},"Ansible molecule coverage by AI","Using Gemini AI webapp for molecule coverage",["Date","2025-06-14T22:00:00.000Z"],"__ASTRO_IMAGE_../../assets/blog-1-image.png","### Context\nNowadays, there's no way of knowing the coverage status of an ansible role by using on of the most popular test framework: molecule\n\nIn this effort, we're trying to use an LLM model where we provide the ansible role code, the molecule code and an optional molecule execution log.\nWith this, we want to know:\n* Deconstruct the Ansible Role: Where we're mapping out every \"when\" condition and variables that are related to them.\n* Analyze molecule test scenarios: Platforms, variable overrides, verification steps...\n* Perform correlation and gap analysis: We want to check which of the role tasks are covered, partial covered or not covered.\n\n### Goals\nWith this we want to output a report where we have a:\n* Summary: A one-paragraph of the overall test coverage status\n* Coverage breakdown: Provide the analysis in CSV format\n* Actionable recommendations: Provice specific and concrete solutions identifying gaps in CSV format\n* Coverage score: Percentage from 0 to 100 of the coverage status.\n* Confidence score: Percentage from 0 to 100 of the confidence in the anaylisis.\n\n### What we've done\nWe've develop an ansible role that inspect each of the roles in an ansible role folder. The role output is a set of Markdown files, one per each role. These files contain a prompt we can use in any of the AI model UI.\nIt requires two variables: One for the ansible role folder path, and another one specifying the output folder.\n\nThe role use ansible for performing the steps:\n* Checking required variables\n* Executing python script: inspect_roles.py Which output is a python dict containing per each role the local URIs of all their meaningful files.\n* Render a jinja2 template based on the output of the python script a prompt for each role.\n\n### Output\nWe've run the create ansible role without any molecule test. The MD file created:\n`````````markdown\n# Ansible Role Test Coverage Analysis for 'virtualbmc'\n\n## 1. Persona\n\n**You are an expert-level DevOps engineer and Ansible automation specialist.** Your primary function is to act as a meticulous quality assurance partner. You have deep expertise in Ansible best practices, idempotence, and comprehensive testing methodologies using Molecule.\n\n## 2. Objective\n\nYour goal is to provide a detailed and actionable test coverage analysis for the provided Ansible role. You will dissect the role's logic, compare it against the provided Molecule test scenarios, and produce a clear report that identifies coverage gaps and offers concrete recommendations for improvement. You must think step-by-step and base all your conclusions on the evidence provided.\n\n---\n\n## 3. Provided Information\n\nHere is the data for the Ansible role `virtualbmc`.\n\n### 3.1. Ansible Role Code\n\n#### Default Variables\n**File:** `main.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n\n# All variables intended for modification should be placed in this file.\n# All variables within this role should have a prefix of \"cifmw_virtualbmc\"\ncifmw_virtualbmc_image: \"quay.io/metal3-io/vbmc:latest\"\ncifmw_virtualbmc_container_name: \"cifmw-vbmc\"\ncifmw_virtualbmc_listen_address: \"127.0.0.1\"\ncifmw_virtualbmc_daemon_port: 50891\n\ncifmw_virtualbmc_machine: null\ncifmw_virtualbmc_action: null\n\ncifmw_virtualbmc_sshkey_path: \"{{ ansible_user_dir }}/.ssh/vbmc-key\"\ncifmw_virtualbmc_sshkey_type: \"{{ cifmw_ssh_keytype | default('ecdsa') }}\"\ncifmw_virtualbmc_sshkey_size: \"{{ cifmw_ssh_keysize | default(521) }}\"\n\ncifmw_virtualbmc_ipmi_key_path: \"/root/ssh/id_rsa_virt_power\"\ncifmw_virtualbmc_ipmi_password: \"password\"\ncifmw_virtualbmc_ipmi_address: \"{{ cifmw_virtualbmc_listen_address }}\"\ncifmw_virtualbmc_ipmi_user: \"admin\"\ncifmw_virtualbmc_ipmi_base_port: 6240\ncifmw_virtualbmc_ipmi_uri: >-\n  qemu+ssh://{{ ansible_user_id }}@{{ cifmw_virtualbmc_ipmi_address }}/system?&keyfile={{ cifmw_virtualbmc_ipmi_key_path }}&no_verify=1&no_tty=1\n```\n\n#### Role Variables\n*No role variables files found.*\n\n#### Tasks\n**File:** `cleanup.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n- name: Install podman and configure session linger\n  ansible.builtin.import_role:\n    name: podman\n\n- name: Stop and remove vbmc container\n  containers.podman.podman_container:\n    name: \"{{ cifmw_virtualbmc_container_name }}\"\n    state: absent\n\n- name: Remove vbmc container image\n  containers.podman.podman_image:\n    name: \"{{ cifmw_virtualbmc_image }}\"\n    state: absent\n\n- name: Check if VBMC key exists\n  register: _vbmc_ssh_stat\n  ansible.builtin.stat:\n    path: \"{{ cifmw_virtualbmc_sshkey_path }}.pub\"\n\n- name: Revoke VBMC temporary key\n  when:\n    - _vbmc_ssh_stat.stat.exists\n  block:\n    - name: Slurp key\n      register: _vbmc_key\n      ansible.builtin.slurp:\n        path: \"{{ cifmw_virtualbmc_sshkey_path }}.pub\"\n\n    - name: Revoke VBMC SSH access\n      ansible.posix.authorized_key:\n        user: \"{{ ansible_user_id }}\"\n        key: \"{{ _vbmc_key.content | b64decode }}\"\n        state: absent\n\n- name: Remove vbmc files\n  vars:\n    dest_dir: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\n  ansible.builtin.file:\n    path: \"{{ item }}\"\n    state: absent\n  loop:\n    - \"{{ cifmw_virtualbmc_sshkey_path }}\"\n    - \"{{ cifmw_virtualbmc_sshkey_path }}.pub\"\n    - \"{{ dest_dir }}/virtualbmc.conf\"\n    - \"{{ dest_dir }}/vbmcd.sh\"\n```\n**File:** `list_hosts.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n- name: Get existing known VBMC nodes\n  register: _known_vbmc\n  ansible.builtin.command:\n    cmd: >-\n      podman exec {{ cifmw_virtualbmc_container_name}}\n      vbmc list -f json\n\n- name: Expose known hosts\n  ansible.builtin.set_fact:\n    cifmw_virtualbmc_known_hosts: >-\n      {{\n        _known_vbmc.stdout | from_json\n      }}\n```\n**File:** `main.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n- name: Ensure needed directories exist\n  ansible.builtin.file:\n    path: \"{{ item.key }}\"\n    state: directory\n    mode: \"{{ item.mode | default('0755') }}\"\n  loop:\n    - key: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\n      mode: \"0700\"\n\n- name: Install podman and configure session linger\n  ansible.builtin.import_role:\n    name: podman\n\n- name: Check if container already exists\n  register: _vbmc_container_info\n  containers.podman.podman_container_info:\n    name: \"{{ cifmw_virtualbmc_container_name }}\"\n\n- name: Run tasks only if container does not exist\n  when:\n    - _vbmc_container_info.containers | length == 0\n  vars:\n    dest_dir: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\n  block:\n    - name: Create ssh key for VBMC\n      register: _vbmc_key\n      community.crypto.openssh_keypair:\n        path: \"{{ cifmw_virtualbmc_sshkey_path }}\"\n        type: \"{{ cifmw_virtualbmc_sshkey_type }}\"\n        size: \"{{ cifmw_virtualbmc_sshkey_size }}\"\n        regenerate: full_idempotence\n\n    - name: Pull vbmc container image\n      containers.podman.podman_image:\n        name: \"{{ cifmw_virtualbmc_image }}\"\n        state: present\n\n    - name: Allow VBMC temporary key\n      ansible.posix.authorized_key:\n        user: \"{{ ansible_user_id }}\"\n        key: \"{{ _vbmc_key.public_key }}\"\n        state: present\n\n    - name: Create ssh_config snippet for VBMC\n      ansible.builtin.copy:\n        dest: \"{{ dest_dir }}/vbmc_ssh_config.conf\"\n        mode: \"0644\"\n        content: |\n          Host *\n            # Avoid trying gssapi, it takes too long and\n            # leads to vbmcd timeout\n            GSSAPIAuthentication no\n\n    - name: Create vbmc server configuration file\n      ansible.builtin.copy:\n        dest: \"{{ dest_dir }}/virtualbmc.conf\"\n        content: |\n          [default]\n          server_port={{ cifmw_virtualbmc_daemon_port }}\n        mode: \"0644\"\n\n    - name: Create undying vbmcd service script\n      ansible.builtin.copy:\n        dest: \"{{ dest_dir }}/vbmcd.sh\"\n        content: |-\n          #!/bin/sh\n          while true; do\n            /usr/local/bin/vbmcd --foreground;\n            echo \"Dying... restarting vbmcd\"\n            sleep 1;\n          done\n        mode: \"0755\"\n\n- name: Create and start vbmc container\n  vars:\n    dest_dir: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\n  containers.podman.podman_container:\n    image: \"{{ cifmw_virtualbmc_image }}\"\n    name: \"{{ cifmw_virtualbmc_container_name }}\"\n    network: host\n    state: started\n    command: \"/vbmcd.sh\"\n    volumes:\n      - \"{{ cifmw_virtualbmc_sshkey_path }}:{{ cifmw_virtualbmc_ipmi_key_path }}:ro,Z\"\n      - \"{{ dest_dir }}/virtualbmc.conf:/etc/virtualbmc/virtualbmc.conf:ro,Z\"\n      - \"{{ dest_dir }}/vbmc_ssh_config.conf:/etc/ssh/ssh_config.d/zzz-gssapi.conf:ro,Z\"\n      - \"{{ dest_dir }}/vbmcd.sh:/vbmcd.sh:ro,Z\"\n```\n**File:** `manage_host.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n- name: Assert we have required data\n  ansible.builtin.assert:\n    that:\n      - cifmw_virtualbmc_action is not none\n      - cifmw_virtualbmc_action in ['add', 'delete']\n      - cifmw_virtualbmc_machine is not none\n\n- name: List existing hosts\n  ansible.builtin.import_tasks: list_hosts.yml\n\n- name: Manage host in VBMC if needed\n  vars:\n    _known_hosts: >-\n      {{\n        cifmw_virtualbmc_known_hosts |\n        selectattr('Domain name', 'equalto', cifmw_virtualbmc_machine) |\n        length\n      }}\n  when:\n    - (cifmw_virtualbmc_action == 'add' and (_known_hosts | int) == 0) or\n      (cifmw_virtualbmc_action == 'delete' and (_known_hosts | int) == 1)\n  block:\n    - name: Stop host in VBMC\n      when:\n        - cifmw_virtualbmc_action == 'delete'\n      ansible.builtin.command:\n        cmd: >-\n          podman exec {{ cifmw_virtualbmc_container_name }}\n          vbmc stop {{ cifmw_virtualbmc_machine }}\n\n    - name: Add new host to VBMC\n      vars:\n        _port: >-\n          {{\n            cifmw_virtualbmc_ipmi_base_port + _known_hosts\n          }}\n      register: _add_host\n      retries: 5\n      delay: 1\n      until: _add_host.rc == 0\n      ansible.builtin.command:\n        cmd: >-\n          podman exec {{ cifmw_virtualbmc_container_name }} vbmc\n          {{ cifmw_virtualbmc_action }}\n          {% if cifmw_virtualbmc_action == 'add' -%}\n          --username \"{{ cifmw_virtualbmc_ipmi_user }}\"\n          --password \"{{ cifmw_virtualbmc_ipmi_password }}\"\n          --libvirt-uri \"{{ cifmw_virtualbmc_ipmi_uri }}\"\n          --port \"{{ cifmw_virtualbmc_ipmi_port }}\"\n          --address \"{{ cifmw_virtualbmc_ipmi_address }}\"\n          {% endif -%}\n          {{ cifmw_virtualbmc_machine }}\n\n    - name: Start new host in VBMC\n      when:\n        - cifmw_virtualbmc_action == 'add'\n      ansible.builtin.command:\n        cmd: >-\n          podman exec {{ cifmw_virtualbmc_container_name }}\n          vbmc start {{ cifmw_virtualbmc_machine }}\n```\n**File:** `verify.yml`\n```yaml\n---\n- name: Ensure vBMC answers\n  register: _vbmc_status\n  ansible.builtin.command:\n    cmd: podman exec {{ cifmw_virtualbmc_container_name }} vbmc list\n  retries: 10\n  delay: 1\n  until:\n    - _vbmc_status.rc is defined\n    - _vbmc_status.rc == 0\n```\n\n#### Handlers\n*No handler files found.*\n\n#### Templates\n*No template files found.*\n\n### 3.2. Molecule Test Code\n#### Scenario: default\n**File:** `cleanup.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n\n- name: Cleanup\n  hosts: all\n  tasks:\n    - name: Clean libvirt layout\n      ansible.builtin.import_role:\n        name: libvirt_manager\n        tasks_from: clean_layout.yml\n\n    - name: Clean vbmc\n      ansible.builtin.import_role:\n        name: virtualbmc\n        tasks_from: cleanup.yml\n```\n**File:** `converge.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n\n- name: Converge\n  hosts: all\n  roles:\n    - role: virtualbmc\n  tasks:\n    - name: Inject compute-0 in VBMC\n      vars:\n        cifmw_virtualbmc_machine: \"cifmw-compute-0\"\n        cifmw_virtualbmc_ipmi_port: >-\n          {{ cifmw_virtualbmc_ipmi_base_port + 1 }}\n        cifmw_virtualbmc_action: 'add'\n      ansible.builtin.import_role:\n        name: virtualbmc\n        tasks_from: manage_host\n\n    - name: Stop VM using IPMI\n      ansible.builtin.command:\n        cmd: >-\n          ipmitool -I lanplus -U admin -P password\n          -H 127.0.0.1 -p 6241 power off\n\n    - name: List VMs from the hypervisor\n      register: _vms\n      community.libvirt.virt:\n        command: info\n        name: \"cifmw-compute-0\"\n\n    - name: Ensure VM is stopped\n      ansible.builtin.assert:\n        that:\n          - _vms['cifmw-compute-0'].state == 'shutdown'\n\n    - name: Get known hosts\n      ansible.builtin.import_role:\n        name: virtualbmc\n        tasks_from: list_hosts.yml\n\n    - name: Ensure we have the needed fact\n      ansible.builtin.assert:\n        that:\n          - cifmw_virtualbmc_known_hosts is defined\n          - cifmw_virtualbmc_known_hosts | length != 0\n\n    - name: Expose known hosts\n      ansible.builtin.debug:\n        var: cifmw_virtualbmc_known_hosts\n\n    - name: Remove compute-0 from VBMC\n      vars:\n        cifmw_virtualbmc_machine: \"cifmw-compute-0\"\n        cifmw_virtualbmc_action: 'delete'\n      ansible.builtin.import_role:\n        name: virtualbmc\n        tasks_from: manage_host\n\n    - name: Get known hosts\n      ansible.builtin.import_role:\n        name: virtualbmc\n        tasks_from: list_hosts.yml\n\n    - name: Ensure we have the needed fact\n      ansible.builtin.assert:\n        that:\n          - cifmw_virtualbmc_known_hosts is defined\n          - cifmw_virtualbmc_known_hosts | length == 0\n```\n**File:** `molecule.yml`\n```yaml\n---\n# Mainly used to override the defaults set in .config/molecule/\n# By default, it uses the \"config_podman.yml\" - in CI, it will use\n# \"config_local.yml\".\nlog: true\n\nprovisioner:\n  name: ansible\n  log: true\n  env:\n    ANSIBLE_STDOUT_CALLBACK: yaml\n```\n**File:** `prepare.yml`\n```yaml\n---\n# Copyright Red Hat, Inc.\n# All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n# not use this file except in compliance with the License. You may obtain\n# a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations\n# under the License.\n\n\n- name: Prepare\n  hosts: all\n  vars:\n    cifmw_basedir: \"{{ ansible_user_dir }}/ci-framework-data\"\n    test_deps_extra_packages:\n      - ipmitool\n  roles:\n    - role: test_deps\n    - role: libvirt_manager\n    - role: discover_latest_image\n  tasks:\n    - name: Load networking definition\n      ansible.builtin.include_vars:\n        file: \"net-def.yml\"\n        name: cifmw_networking_definition\n\n    - name: Deploy a single VM\n      vars:\n        cifmw_libvirt_manager_configuration:\n          vms:\n            compute:\n              amount: 1\n              disk_file_name: \"blank\"\n              disksize: 15\n              memory: 4\n              cpus: 2\n              nets:\n                - public\n          networks:\n            public: |-\n              \u003Cnetwork>\n                \u003Cname>public\u003C/name>\n                \u003Cforward mode='nat'/>\n                \u003Cbridge name='public' stp='on' delay='0'/>\n                \u003Cmac address='52:54:00:6a:f2:dc'/>\n                \u003Cip family='ipv4' address='192.168.110.1' prefix='24'>\n                  \u003Cdhcp>\n                    \u003Crange start='192.168.110.10' end='192.168.110.100'/>\n                  \u003C/dhcp>\n                \u003C/ip>\n              \u003C/network>\n      ansible.builtin.import_role:\n        name: libvirt_manager\n        tasks_from: deploy_layout.yml\n```\n\n### 3.3. (Optional) Molecule Execution Logs\n*No execution logs provided.*\n\n---\n\n## 4. Analysis Instructions\n\n**Critically evaluate the provided information by following these steps:**\n\n### Step 1: Deconstruct the Ansible Role\nFirst, thoroughly analyze the role's source code. Do not output this preliminary analysis, but use it to build your final report.\n- **Tasks & Handlers:** Systematically list every task and handler. Identify any `include_tasks`, `import_tasks`, and tasks within loops (`loop`, `with_*`). Note which tasks notify handlers.\n- **Conditional Logic:** Map out every `when` condition. Note the variables that control these conditions.\n- **Variables:** List all default variables and their values. Understand their purpose and impact on execution paths. Note any variables defined in `vars/`.\n- **Templates:** Identify all templates and the variables they use.\n\n### Step 2: Analyze the Molecule Test Scenarios\nFor each Molecule scenario provided:\n- **Platforms:** Note the operating systems being tested (e.g., from `molecule.yml`).\n- **Variable Overrides:** Identify all variables that are overridden in `converge.yml` or `molecule.yml`.\n- **Verification Steps:** List the explicit checks performed by the verifier (e.g., `test_*.py` files or `verify.yml`). What states are being asserted? Are services running? Are files present with specific content?\n\n### Step 3: Perform Correlation and Gap Analysis (Chain-of-Thought)\nThis is the most critical step. You must connect the role's logic to the test scenarios.\n- For every task, handler, conditional path, and variable, determine if it is adequately tested by the combination of all Molecule scenarios.\n- **State your reasoning clearly for each element.** Use the provided logs as concrete evidence. For example:\n    - *\"The task 'Install Apache on RedHat' is **NOT COVERED** because the Molecule scenarios only use Debian-based images, causing the condition `when: ansible_os_family == 'RedHat'` to always be false.\"*\n    - *\"The variable `httpd_port` is **PARTIALLY COVERED**. The role is tested with the default value (80), but no scenario overrides this variable to test a custom port configuration.\"*\n    - *\"The loop in 'Create user accounts' is **INSUFFICIENTLY TESTED**. The test provides a single user in the list, which does not cover the edge cases of an empty list or a list with multiple users.\"*\n    - *\"The handler 'Restart apache' is **COVERED**. The log snippet shows 'RUNNING HANDLER [Restart apache]'.\"*\n\n---\n\n## 5. Required Report Format\n\n**Generate the report below using Markdown. Do not include any other commentary before or after the report.**\n\n# Ansible Role Coverage Report: Virtualbmc\n\n### Executive Summary\nProvide a concise, one-paragraph summary of the overall test coverage status. Highlight the most critical gaps found and the role's overall testability.\n\n### Coverage Breakdown\nProvide the analysis in a CSV format enclosed in a markdown code block. Use a semicolon (`;`) as the delimiter.\n\n```csv\nElement Type;Name/Condition;Covered?;Justification/Evidence\nTask;Install Nginx;Yes;Converge playbook includes the role, and the verify playbook asserts the 'nginx' package is present and the service is running.\nCondition;when: ansible_os_family == \"RedHat\";No;The provided Molecule scenarios only use Debian 11 and Ubuntu 22.04 platforms. The RedHat-specific tasks are never executed.\nVariable;nginx_port;Partial;The role is tested with the default port (80), but no scenario provides a custom port to verify the template and service configuration are updated correctly.\nLoop;Create virtual hosts;Partial;The test covers a single virtual host. It does not validate behavior with an empty list of vhosts (should do nothing) or a multi-vhost configuration.\nHandler;Restart Nginx;Yes;The converge log shows the 'Configure Nginx' task notified this handler, and the handler executed successfully.\n```\n\n### Actionable Recommendations\nProvide concrete, specific solutions for the identified gaps. Output as a CSV format enclosed in a markdown code block. Use a semicolon (`;`) as the delimiter.\n\n```csv\nIdentified Gap;Recommended Solution;Example Snippet (for molecule.yml or converge.yml)\nRedHat family tasks are untested.;Add a new Molecule platform for a RedHat-based OS like Rocky Linux or CentOS Stream.;\"platforms:\\n  - name: instance-rocky9\\n    image: rockylinux/rockylinux:9\"\nCustom port configuration is untested.;Create a new Molecule scenario named 'custom_port'. In its `converge.yml`, override the `nginx_port` variable.;\"vars:\\n  nginx_port: 8080\"\nLoop behavior with an empty list is unknown.;Add an assertion to a verifier or a simple `converge_empty.yml` playbook that runs the role with the vhost list variable set to an empty array `[]`.;\"vars:\\n  nginx_vhosts: []\"\n```\n\n### Coverage Score\n**Score**: [Provide a percentage from 0 to 100]%\n**Justification**: [Provide a one-paragraph explanation for the score, directly referencing the findings from the Coverage Breakdown. For example, mention the percentage of tasks covered, the significance of the untested conditional paths, and the impact of variable coverage.]\n\n### Confidence Score\n**Score**: [Provide a percentage from 0 to 100]%\n**Justification**: [Provide a one-paragraph explanation for your confidence in the analysis. If information was missing (e.g., no logs, unclear verifier), state it here and explain how it impacts your confidence. For example: \"Confidence is high due to the presence of detailed logs and explicit verifier checks. All execution paths could be confirmed or denied with evidence.\"]\n\n### Disclaimer\nIf the analysis is inconclusive due to insufficient data (e.g., no `converge.yml`, no verifiers), please state what information is missing and why it is essential for a complete analysis.\n`````````\n\n### Ansible Role Coverage Report: Virtualbmc\n\n#### Executive Summary\nThe virtualbmc role demonstrates good basic functionality coverage with successful deployment, container management, and host management operations. However, significant gaps exist in error handling, edge case testing, and comprehensive validation of all configuration parameters. The role lacks testing for failure scenarios, custom variable configurations, and comprehensive verification of generated configuration files. Critical areas like SSH key management, container restart scenarios, and IPMI connectivity validation are insufficiently tested.\n\n#### Coverage Breakdown\n![Coverage Breakdown image loading failed](../../assets/blog-1-csv-1.png)\n\n#### Actionable Recommendations\n![Actionable Recommendations image loading failed](../../assets/blog-1-csv-2.png)\n\n#### Coverage Score\nScore: 65%\nJustification: The role achieves good coverage of core functionality with successful deployment, basic host management, and cleanup operations. However, significant gaps exist in edge case testing, error handling, and comprehensive variable validation. While primary execution paths are covered (container deployment, host add/delete, cleanup), critical areas like custom configurations, failure scenarios, container restart handling, and comprehensive verification are insufficiently tested. The lack of verify.yml execution and limited variable override testing particularly impact the score.\n\n#### Confidence Score\nScore: 85%\nJustification: Confidence is high due to clear evidence from the converge.yml execution showing successful VBMC operations, IPMI connectivity, and VM state management. The test scenarios provide concrete evidence of task execution and state changes. However, confidence is slightly reduced by the absence of verify.yml execution logs and limited testing of edge cases. The provided code structure is comprehensive enough to assess most coverage gaps with reasonable certainty.\n\n#### Disclaimer\nThe analysis is based on the provided role code and single Molecule scenario. Additional confidence would be gained from: (1) execution logs showing verify.yml task execution, (2) additional test scenarios covering edge cases and custom configurations, and (3) more comprehensive verifier checks validating generated configuration files and container state persistence across restarts.","src/content/blog/ai-ansible-molecule.md",[21,22,23],"../../assets/blog-1-csv-1.png","../../assets/blog-1-csv-2.png","../../assets/blog-1-image.png","37cd119967b13248",{"html":26,"metadata":27},"\u003Ch3 id=\"context\">Context\u003C/h3>\n\u003Cp>Nowadays, there’s no way of knowing the coverage status of an ansible role by using on of the most popular test framework: molecule\u003C/p>\n\u003Cp>In this effort, we’re trying to use an LLM model where we provide the ansible role code, the molecule code and an optional molecule execution log.\nWith this, we want to know:\u003C/p>\n\u003Cul>\n\u003Cli>Deconstruct the Ansible Role: Where we’re mapping out every “when” condition and variables that are related to them.\u003C/li>\n\u003Cli>Analyze molecule test scenarios: Platforms, variable overrides, verification steps…\u003C/li>\n\u003Cli>Perform correlation and gap analysis: We want to check which of the role tasks are covered, partial covered or not covered.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"goals\">Goals\u003C/h3>\n\u003Cp>With this we want to output a report where we have a:\u003C/p>\n\u003Cul>\n\u003Cli>Summary: A one-paragraph of the overall test coverage status\u003C/li>\n\u003Cli>Coverage breakdown: Provide the analysis in CSV format\u003C/li>\n\u003Cli>Actionable recommendations: Provice specific and concrete solutions identifying gaps in CSV format\u003C/li>\n\u003Cli>Coverage score: Percentage from 0 to 100 of the coverage status.\u003C/li>\n\u003Cli>Confidence score: Percentage from 0 to 100 of the confidence in the anaylisis.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"what-weve-done\">What we’ve done\u003C/h3>\n\u003Cp>We’ve develop an ansible role that inspect each of the roles in an ansible role folder. The role output is a set of Markdown files, one per each role. These files contain a prompt we can use in any of the AI model UI.\nIt requires two variables: One for the ansible role folder path, and another one specifying the output folder.\u003C/p>\n\u003Cp>The role use ansible for performing the steps:\u003C/p>\n\u003Cul>\n\u003Cli>Checking required variables\u003C/li>\n\u003Cli>Executing python script: inspect_roles.py Which output is a python dict containing per each role the local URIs of all their meaningful files.\u003C/li>\n\u003Cli>Render a jinja2 template based on the output of the python script a prompt for each role.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"output\">Output\u003C/h3>\n\u003Cp>We’ve run the create ansible role without any molecule test. The MD file created:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"markdown\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\"># Ansible Role Test Coverage Analysis for 'virtualbmc'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">## 1. Persona\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**You are an expert-level DevOps engineer and Ansible automation specialist.**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Your primary function is to act as a meticulous quality assurance partner. You have deep expertise in Ansible best practices, idempotence, and comprehensive testing methodologies using Molecule.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">## 2. Objective\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Your goal is to provide a detailed and actionable test coverage analysis for the provided Ansible role. You will dissect the role's logic, compare it against the provided Molecule test scenarios, and produce a clear report that identifies coverage gaps and offers concrete recommendations for improvement. You must think step-by-step and base all your conclusions on the evidence provided.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">## 3. Provided Information\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Here is the data for the Ansible role \u003C/span>\u003Cspan style=\"color:#79B8FF\">`virtualbmc`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### 3.1. Ansible Role Code\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">#### Default Variables\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `main.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All variables intended for modification should be placed in this file.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All variables within this role should have a prefix of \"cifmw_virtualbmc\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_image: \"quay.io/metal3-io/vbmc:latest\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_container_name: \"cifmw-vbmc\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_listen_address: \"127.0.0.1\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_daemon_port: 50891\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_machine: null\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_action: null\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_sshkey_path: \"{{ ansible_user_dir }}/.ssh/vbmc-key\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_sshkey_type: \"{{ cifmw_ssh_keytype | default('ecdsa') }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_sshkey_size: \"{{ cifmw_ssh_keysize | default(521) }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_ipmi_key_path: \"/root/ssh/id_rsa_virt_power\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_ipmi_password: \"password\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_ipmi_address: \"{{ cifmw_virtualbmc_listen_address }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_ipmi_user: \"admin\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_ipmi_base_port: 6240\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">cifmw_virtualbmc_ipmi_uri: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  qemu+ssh://{{ ansible_user_id }}@{{ cifmw_virtualbmc_ipmi_address }}/system?&#x26;keyfile={{ cifmw_virtualbmc_ipmi_key_path }}&#x26;no_verify=1&#x26;no_tty=1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">#### Role Variables\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-style:italic\">*No role variables files found.*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">#### Tasks\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `cleanup.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Install podman and configure session linger\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    name: podman\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Stop and remove vbmc container\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  containers.podman.podman_container:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    name: \"{{ cifmw_virtualbmc_container_name }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    state: absent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Remove vbmc container image\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  containers.podman.podman_image:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    name: \"{{ cifmw_virtualbmc_image }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    state: absent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Check if VBMC key exists\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  register: _vbmc_ssh_stat\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.stat:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    path: \"{{ cifmw_virtualbmc_sshkey_path }}.pub\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Revoke VBMC temporary key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  when:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - _vbmc_ssh_stat.stat.exists\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  block:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Slurp key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      register: _vbmc_key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.slurp:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        path: \"{{ cifmw_virtualbmc_sshkey_path }}.pub\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Revoke VBMC SSH access\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.posix.authorized_key:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        user: \"{{ ansible_user_id }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        key: \"{{ _vbmc_key.content | b64decode }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        state: absent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Remove vbmc files\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    dest_dir: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.file:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    path: \"{{ item }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    state: absent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  loop:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - \"{{ cifmw_virtualbmc_sshkey_path }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - \"{{ cifmw_virtualbmc_sshkey_path }}.pub\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - \"{{ dest_dir }}/virtualbmc.conf\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - \"{{ dest_dir }}/vbmcd.sh\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `list_hosts.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Get existing known VBMC nodes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  register: _known_vbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.command:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    cmd: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      podman exec {{ cifmw_virtualbmc_container_name}}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      vbmc list -f json\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Expose known hosts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.set_fact:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    cifmw_virtualbmc_known_hosts: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      {{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        _known_vbmc.stdout | from_json\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `main.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Ensure needed directories exist\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.file:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    path: \"{{ item.key }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    state: directory\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    mode: \"{{ item.mode | default('0755') }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  loop:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - key: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      mode: \"0700\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Install podman and configure session linger\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    name: podman\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Check if container already exists\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  register: _vbmc_container_info\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  containers.podman.podman_container_info:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    name: \"{{ cifmw_virtualbmc_container_name }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Run tasks only if container does not exist\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  when:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - _vbmc_container_info.containers | length == 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    dest_dir: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  block:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Create ssh key for VBMC\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      register: _vbmc_key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      community.crypto.openssh_keypair:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        path: \"{{ cifmw_virtualbmc_sshkey_path }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        type: \"{{ cifmw_virtualbmc_sshkey_type }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        size: \"{{ cifmw_virtualbmc_sshkey_size }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        regenerate: full_idempotence\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Pull vbmc container image\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      containers.podman.podman_image:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: \"{{ cifmw_virtualbmc_image }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        state: present\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Allow VBMC temporary key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.posix.authorized_key:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        user: \"{{ ansible_user_id }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        key: \"{{ _vbmc_key.public_key }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        state: present\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Create ssh_config snippet for VBMC\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.copy:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        dest: \"{{ dest_dir }}/vbmc_ssh_config.conf\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        mode: \"0644\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        content: |\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          Host *\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            # Avoid trying gssapi, it takes too long and\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            # leads to vbmcd timeout\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            GSSAPIAuthentication no\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Create vbmc server configuration file\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.copy:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        dest: \"{{ dest_dir }}/virtualbmc.conf\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        content: |\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          [default]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          server_port={{ cifmw_virtualbmc_daemon_port }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        mode: \"0644\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Create undying vbmcd service script\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.copy:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        dest: \"{{ dest_dir }}/vbmcd.sh\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        content: |-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          #!/bin/sh\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          while true; do\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            /usr/local/bin/vbmcd --foreground;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            echo \"Dying... restarting vbmcd\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            sleep 1;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          done\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        mode: \"0755\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Create and start vbmc container\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    dest_dir: \"{{ cifmw_virtualbmc_sshkey_path | dirname }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  containers.podman.podman_container:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    image: \"{{ cifmw_virtualbmc_image }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    name: \"{{ cifmw_virtualbmc_container_name }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    network: host\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    state: started\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    command: \"/vbmcd.sh\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    volumes:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - \"{{ cifmw_virtualbmc_sshkey_path }}:{{ cifmw_virtualbmc_ipmi_key_path }}:ro,Z\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - \"{{ dest_dir }}/virtualbmc.conf:/etc/virtualbmc/virtualbmc.conf:ro,Z\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - \"{{ dest_dir }}/vbmc_ssh_config.conf:/etc/ssh/ssh_config.d/zzz-gssapi.conf:ro,Z\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - \"{{ dest_dir }}/vbmcd.sh:/vbmcd.sh:ro,Z\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `manage_host.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Assert we have required data\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.assert:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    that:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - cifmw_virtualbmc_action is not none\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - cifmw_virtualbmc_action in ['add', 'delete']\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - cifmw_virtualbmc_machine is not none\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: List existing hosts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.import_tasks: list_hosts.yml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Manage host in VBMC if needed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    _known_hosts: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      {{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cifmw_virtualbmc_known_hosts |\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        selectattr('Domain name', 'equalto', cifmw_virtualbmc_machine) |\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        length\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  when:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - (cifmw_virtualbmc_action == 'add' and (_known_hosts | int) == 0) or\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      (cifmw_virtualbmc_action == 'delete' and (_known_hosts | int) == 1)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  block:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Stop host in VBMC\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      when:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        - cifmw_virtualbmc_action == 'delete'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.command:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cmd: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          podman exec {{ cifmw_virtualbmc_container_name }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          vbmc stop {{ cifmw_virtualbmc_machine }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Add new host to VBMC\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        _port: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          {{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            cifmw_virtualbmc_ipmi_base_port + _known_hosts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      register: _add_host\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      retries: 5\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      delay: 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      until: _add_host.rc == 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.command:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cmd: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          podman exec {{ cifmw_virtualbmc_container_name }} vbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          {{ cifmw_virtualbmc_action }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          {% if cifmw_virtualbmc_action == 'add' -%}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          --username \"{{ cifmw_virtualbmc_ipmi_user }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          --password \"{{ cifmw_virtualbmc_ipmi_password }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          --libvirt-uri \"{{ cifmw_virtualbmc_ipmi_uri }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          --port \"{{ cifmw_virtualbmc_ipmi_port }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          --address \"{{ cifmw_virtualbmc_ipmi_address }}\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          {% endif -%}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          {{ cifmw_virtualbmc_machine }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Start new host in VBMC\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      when:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        - cifmw_virtualbmc_action == 'add'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.command:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cmd: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          podman exec {{ cifmw_virtualbmc_container_name }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          vbmc start {{ cifmw_virtualbmc_machine }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `verify.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Ensure vBMC answers\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  register: _vbmc_status\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  ansible.builtin.command:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    cmd: podman exec {{ cifmw_virtualbmc_container_name }} vbmc list\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  retries: 10\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  delay: 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  until:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - _vbmc_status.rc is defined\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - _vbmc_status.rc == 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">#### Handlers\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-style:italic\">*No handler files found.*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">#### Templates\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-style:italic\">*No template files found.*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### 3.2. Molecule Test Code\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">#### Scenario: default\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `cleanup.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Cleanup\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  hosts: all\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  tasks:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Clean libvirt layout\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: libvirt_manager\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        tasks_from: clean_layout.yml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Clean vbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: virtualbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        tasks_from: cleanup.yml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `converge.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Converge\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  hosts: all\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  roles:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - role: virtualbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  tasks:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Inject compute-0 in VBMC\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cifmw_virtualbmc_machine: \"cifmw-compute-0\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cifmw_virtualbmc_ipmi_port: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          {{ cifmw_virtualbmc_ipmi_base_port + 1 }}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cifmw_virtualbmc_action: 'add'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: virtualbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        tasks_from: manage_host\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Stop VM using IPMI\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.command:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cmd: >-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          ipmitool -I lanplus -U admin -P password\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          -H 127.0.0.1 -p 6241 power off\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: List VMs from the hypervisor\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      register: _vms\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      community.libvirt.virt:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        command: info\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: \"cifmw-compute-0\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Ensure VM is stopped\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.assert:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        that:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          - _vms['cifmw-compute-0'].state == 'shutdown'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Get known hosts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: virtualbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        tasks_from: list_hosts.yml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Ensure we have the needed fact\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.assert:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        that:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          - cifmw_virtualbmc_known_hosts is defined\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          - cifmw_virtualbmc_known_hosts | length != 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Expose known hosts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.debug:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        var: cifmw_virtualbmc_known_hosts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Remove compute-0 from VBMC\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cifmw_virtualbmc_machine: \"cifmw-compute-0\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cifmw_virtualbmc_action: 'delete'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: virtualbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        tasks_from: manage_host\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Get known hosts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: virtualbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        tasks_from: list_hosts.yml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Ensure we have the needed fact\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.assert:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        that:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          - cifmw_virtualbmc_known_hosts is defined\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          - cifmw_virtualbmc_known_hosts | length == 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `molecule.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Mainly used to override the defaults set in .config/molecule/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># By default, it uses the \"config_podman.yml\" - in CI, it will use\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># \"config_local.yml\".\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">log: true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">provisioner:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  name: ansible\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  log: true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  env:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ANSIBLE_STDOUT_CALLBACK: yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**File:**\u003C/span>\u003Cspan style=\"color:#79B8FF\"> `prepare.yml`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```yaml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Copyright Red Hat, Inc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># All Rights Reserved.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Licensed under the Apache License, Version 2.0 (the \"License\"); you may\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># not use this file except in compliance with the License. You may obtain\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># a copy of the License at\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#     http://www.apache.org/licenses/LICENSE-2.0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">#\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># Unless required by applicable law or agreed to in writing, software\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># License for the specific language governing permissions and limitations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\"># under the License.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">- name: Prepare\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  hosts: all\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    cifmw_basedir: \"{{ ansible_user_dir }}/ci-framework-data\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    test_deps_extra_packages:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      - ipmitool\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  roles:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - role: test_deps\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - role: libvirt_manager\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - role: discover_latest_image\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  tasks:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Load networking definition\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.include_vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        file: \"net-def.yml\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: cifmw_networking_definition\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    - name: Deploy a single VM\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      vars:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        cifmw_libvirt_manager_configuration:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          vms:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            compute:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              amount: 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              disk_file_name: \"blank\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              disksize: 15\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              memory: 4\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              cpus: 2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              nets:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                - public\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">          networks:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            public: |-\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              &#x3C;network>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                &#x3C;name>public&#x3C;/name>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                &#x3C;forward mode='nat'/>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                &#x3C;bridge name='public' stp='on' delay='0'/>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                &#x3C;mac address='52:54:00:6a:f2:dc'/>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                &#x3C;ip family='ipv4' address='192.168.110.1' prefix='24'>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                  &#x3C;dhcp>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    &#x3C;range start='192.168.110.10' end='192.168.110.100'/>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                  &#x3C;/dhcp>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                &#x3C;/ip>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">              &#x3C;/network>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">      ansible.builtin.import_role:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        name: libvirt_manager\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        tasks_from: deploy_layout.yml\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### 3.3. (Optional) Molecule Execution Logs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-style:italic\">*No execution logs provided.*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">## 4. Analysis Instructions\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**Critically evaluate the provided information by following these steps:**\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Step 1: Deconstruct the Ansible Role\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">First, thoroughly analyze the role's source code. Do not output this preliminary analysis, but use it to build your final report.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **Tasks &#x26; Handlers:**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Systematically list every task and handler. Identify any \u003C/span>\u003Cspan style=\"color:#79B8FF\">`include_tasks`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">`import_tasks`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, and tasks within loops (\u003C/span>\u003Cspan style=\"color:#79B8FF\">`loop`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">`with_*`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">). Note which tasks notify handlers.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **Conditional Logic:**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Map out every \u003C/span>\u003Cspan style=\"color:#79B8FF\">`when`\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> condition. Note the variables that control these conditions.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **Variables:**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> List all default variables and their values. Understand their purpose and impact on execution paths. Note any variables defined in \u003C/span>\u003Cspan style=\"color:#79B8FF\">`vars/`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **Templates:**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Identify all templates and the variables they use.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Step 2: Analyze the Molecule Test Scenarios\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">For each Molecule scenario provided:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **Platforms:**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Note the operating systems being tested (e.g., from \u003C/span>\u003Cspan style=\"color:#79B8FF\">`molecule.yml`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">).\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **Variable Overrides:**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Identify all variables that are overridden in \u003C/span>\u003Cspan style=\"color:#79B8FF\">`converge.yml`\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> or \u003C/span>\u003Cspan style=\"color:#79B8FF\">`molecule.yml`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **Verification Steps:**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> List the explicit checks performed by the verifier (e.g., \u003C/span>\u003Cspan style=\"color:#79B8FF\">`test_*.py`\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> files or \u003C/span>\u003Cspan style=\"color:#79B8FF\">`verify.yml`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">). What states are being asserted? Are services running? Are files present with specific content?\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Step 3: Perform Correlation and Gap Analysis (Chain-of-Thought)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">This is the most critical step. You must connect the role's logic to the test scenarios.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> For every task, handler, conditional path, and variable, determine if it is adequately tested by the combination of all Molecule scenarios.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\"> **State your reasoning clearly for each element.**\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Use the provided logs as concrete evidence. For example:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    -\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\"> *\"The task 'Install Apache on RedHat' is \u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**NOT COVERED**\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\"> because the Molecule scenarios only use Debian-based images, causing the condition \u003C/span>\u003Cspan style=\"color:#79B8FF;font-style:italic\">`when: ansible_os_family == 'RedHat'`\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\"> to always be false.\"*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    -\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\"> *\"The variable \u003C/span>\u003Cspan style=\"color:#79B8FF;font-style:italic\">`httpd_port`\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\"> is \u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**PARTIALLY COVERED**\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\">. The role is tested with the default value (80), but no scenario overrides this variable to test a custom port configuration.\"*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    -\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\"> *\"The loop in 'Create user accounts' is \u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**INSUFFICIENTLY TESTED**\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\">. The test provides a single user in the list, which does not cover the edge cases of an empty list or a list with multiple users.\"*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    -\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\"> *\"The handler 'Restart apache' is \u003C/span>\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**COVERED**\u003C/span>\u003Cspan style=\"color:#E1E4E8;font-style:italic\">. The log snippet shows 'RUNNING HANDLER [Restart apache]'.\"*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">## 5. Required Report Format\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**Generate the report below using Markdown. Do not include any other commentary before or after the report.**\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\"># Ansible Role Coverage Report: Virtualbmc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Executive Summary\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Provide a concise, one-paragraph summary of the overall test coverage status. Highlight the most critical gaps found and the role's overall testability.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Coverage Breakdown\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Provide the analysis in a CSV format enclosed in a markdown code block. Use a semicolon (\u003C/span>\u003Cspan style=\"color:#79B8FF\">`;`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) as the delimiter.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```csv\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Element Type;Name/Condition;Covered?;Justification/Evidence\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Task;Install Nginx;Yes;Converge playbook includes the role, and the verify playbook asserts the 'nginx' package is present and the service is running.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Condition;when: ansible_os_family == \"RedHat\";No;The provided Molecule scenarios only use Debian 11 and Ubuntu 22.04 platforms. The RedHat-specific tasks are never executed.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Variable;nginx_port;Partial;The role is tested with the default port (80), but no scenario provides a custom port to verify the template and service configuration are updated correctly.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Loop;Create virtual hosts;Partial;The test covers a single virtual host. It does not validate behavior with an empty list of vhosts (should do nothing) or a multi-vhost configuration.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Handler;Restart Nginx;Yes;The converge log shows the 'Configure Nginx' task notified this handler, and the handler executed successfully.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Actionable Recommendations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Provide concrete, specific solutions for the identified gaps. Output as a CSV format enclosed in a markdown code block. Use a semicolon (\u003C/span>\u003Cspan style=\"color:#79B8FF\">`;`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) as the delimiter.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```csv\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Identified Gap;Recommended Solution;Example Snippet (for molecule.yml or converge.yml)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">RedHat family tasks are untested.;Add a new Molecule platform for a RedHat-based OS like Rocky Linux or CentOS Stream.;\"platforms:\\n  - name: instance-rocky9\\n    image: rockylinux/rockylinux:9\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Custom port configuration is untested.;Create a new Molecule scenario named 'custom_port'. In its `converge.yml`, override the `nginx_port` variable.;\"vars:\\n  nginx_port: 8080\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">Loop behavior with an empty list is unknown.;Add an assertion to a verifier or a simple `converge_empty.yml` playbook that runs the role with the vhost list variable set to an empty array `[]`.;\"vars:\\n  nginx_vhosts: []\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">```\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Coverage Score\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**Score**\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: [Provide a percentage from 0 to 100]%\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**Justification**\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: [Provide a one-paragraph explanation for the score, directly referencing the findings from the Coverage Breakdown. For example, mention the percentage of tasks covered, the significance of the untested conditional paths, and the impact of variable coverage.]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Confidence Score\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**Score**\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: [Provide a percentage from 0 to 100]%\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8;font-weight:bold\">**Justification**\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: [Provide a one-paragraph explanation for your confidence in the analysis. If information was missing (e.g., no logs, unclear verifier), state it here and explain how it impacts your confidence. For example: \"Confidence is high due to the presence of detailed logs and explicit verifier checks. All execution paths could be confirmed or denied with evidence.\"]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF;font-weight:bold\">### Disclaimer\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">If the analysis is inconclusive due to insufficient data (e.g., no \u003C/span>\u003Cspan style=\"color:#79B8FF\">`converge.yml`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, no verifiers), please state what information is missing and why it is essential for a complete analysis.\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"ansible-role-coverage-report-virtualbmc\">Ansible Role Coverage Report: Virtualbmc\u003C/h3>\n\u003Ch4 id=\"executive-summary\">Executive Summary\u003C/h4>\n\u003Cp>The virtualbmc role demonstrates good basic functionality coverage with successful deployment, container management, and host management operations. However, significant gaps exist in error handling, edge case testing, and comprehensive validation of all configuration parameters. The role lacks testing for failure scenarios, custom variable configurations, and comprehensive verification of generated configuration files. Critical areas like SSH key management, container restart scenarios, and IPMI connectivity validation are insufficiently tested.\u003C/p>\n\u003Ch4 id=\"coverage-breakdown\">Coverage Breakdown\u003C/h4>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/blog-1-csv-1.png&#x22;,&#x22;alt&#x22;:&#x22;Coverage Breakdown image loading failed&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch4 id=\"actionable-recommendations\">Actionable Recommendations\u003C/h4>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/blog-1-csv-2.png&#x22;,&#x22;alt&#x22;:&#x22;Actionable Recommendations image loading failed&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch4 id=\"coverage-score\">Coverage Score\u003C/h4>\n\u003Cp>Score: 65%\nJustification: The role achieves good coverage of core functionality with successful deployment, basic host management, and cleanup operations. However, significant gaps exist in edge case testing, error handling, and comprehensive variable validation. While primary execution paths are covered (container deployment, host add/delete, cleanup), critical areas like custom configurations, failure scenarios, container restart handling, and comprehensive verification are insufficiently tested. The lack of verify.yml execution and limited variable override testing particularly impact the score.\u003C/p>\n\u003Ch4 id=\"confidence-score\">Confidence Score\u003C/h4>\n\u003Cp>Score: 85%\nJustification: Confidence is high due to clear evidence from the converge.yml execution showing successful VBMC operations, IPMI connectivity, and VM state management. The test scenarios provide concrete evidence of task execution and state changes. However, confidence is slightly reduced by the absence of verify.yml execution logs and limited testing of edge cases. The provided code structure is comprehensive enough to assess most coverage gaps with reasonable certainty.\u003C/p>\n\u003Ch4 id=\"disclaimer\">Disclaimer\u003C/h4>\n\u003Cp>The analysis is based on the provided role code and single Molecule scenario. Additional confidence would be gained from: (1) execution logs showing verify.yml task execution, (2) additional test scenarios covering edge cases and custom configurations, and (3) more comprehensive verifier checks validating generated configuration files and container state persistence across restarts.\u003C/p>",{"headings":28,"localImagePaths":64,"remoteImagePaths":65,"frontmatter":66,"imagePaths":68},[29,33,36,39,42,45,49,52,55,58,61],{"depth":30,"slug":31,"text":32},3,"context","Context",{"depth":30,"slug":34,"text":35},"goals","Goals",{"depth":30,"slug":37,"text":38},"what-weve-done","What we’ve done",{"depth":30,"slug":40,"text":41},"output","Output",{"depth":30,"slug":43,"text":44},"ansible-role-coverage-report-virtualbmc","Ansible Role Coverage Report: Virtualbmc",{"depth":46,"slug":47,"text":48},4,"executive-summary","Executive Summary",{"depth":46,"slug":50,"text":51},"coverage-breakdown","Coverage Breakdown",{"depth":46,"slug":53,"text":54},"actionable-recommendations","Actionable Recommendations",{"depth":46,"slug":56,"text":57},"coverage-score","Coverage Score",{"depth":46,"slug":59,"text":60},"confidence-score","Confidence Score",{"depth":46,"slug":62,"text":63},"disclaimer","Disclaimer",[21,22],[],{"title":14,"description":15,"pubDate":67,"heroImage":23},"June 15 2025",[21,22]]